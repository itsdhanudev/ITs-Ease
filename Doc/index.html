<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ITs-Ease Playground — Sidebar (Touch & Android optimized)</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@300;400;500&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0d1117; --panel:#0f1418; --muted:#8b949e; --text:#c9d1d9;
  --accent:#58a6ff; --accent-2:#7f5af0; --card-grad: linear-gradient(145deg,#0f1720,#0b0f12);
  --toggle-on:#58a6ff; --toggle-off:#30363d; --sidebar-w:260px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Roboto,system-ui,Arial;scroll-behavior:smooth; -webkit-font-smoothing:antialiased; -webkit-text-size-adjust:100%;}
.header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.02)}
.title{font-family:Poppins;font-weight:600;color:var(--accent);font-size:20px}
.top-actions{display:flex;gap:10px;align-items:center}
.settings-btn{background:linear-gradient(90deg,#091015,#12171b);border:1px solid rgba(255,255,255,0.04);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer;font-family:Roboto;font-size:13px}
.container{display:grid;grid-template-columns:var(--sidebar-w) 1fr;gap:18px;padding:18px 18px 36px 18px}

/* Sidebar */
.sidebar{position:sticky;top:18px;align-self:flex-start;height:calc(100vh - 36px);background:linear-gradient(180deg,#071018,#0b0f12);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.02);box-shadow:0 8px 30px rgba(0,0,0,0.6);overflow:auto;-webkit-overflow-scrolling:touch}
.search{display:flex;gap:8px;margin-bottom:10px}
.search input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:#071018;color:var(--text);font-size:13px}
.sidebar h4{margin:6px 0 8px 0;color:var(--muted);font-size:12px}
.sidebar-list{list-style:none;padding:0;margin:0;display:block}
.sidebar-item{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;color:var(--text);cursor:pointer;transition:transform .12s ease, background .12s ease;user-select:none}
.sidebar-item:hover{transform:translateX(6px);background:rgba(88,166,255,0.04)}
.sidebar-item .name{font-size:13px}
.sidebar-item .meta{color:var(--muted);font-size:12px;margin-left:auto}
.sidebar-item.active{background:linear-gradient(90deg, rgba(127,90,240,0.12), rgba(88,166,255,0.06));box-shadow:inset 0 0 0 1px rgba(127,90,240,0.04)}
/* vertical indicator */
.sidebar-indicator{position:relative;height:6px;margin-top:12px;border-radius:999px;background:linear-gradient(90deg,#1b2430,#071018);overflow:hidden}
.sidebar-indicator .bar{position:absolute;left:0;top:0;height:100%;width:44px;background:linear-gradient(90deg,var(--accent),var(--accent-2));border-radius:999px;transform:translateX(0);transition:transform .28s cubic-bezier(.2,.9,.2,1),width .2s ease}

/* Responsive: collapse sidebar */
.hamburger{display:none;width:44px;height:44px;border-radius:8px;background:#0b1116;border:1px solid rgba(255,255,255,0.03);cursor:pointer;align-items:center;justify-content:center}
@media (max-width:980px){
  .container{grid-template-columns:1fr;padding:12px}
  .sidebar{position:fixed;left:8px;top:66px;width:calc(var(--sidebar-w) - 28px);height:calc(100vh - 80px);z-index:200;transform:translateX(-120%);transition:transform .28s cubic-bezier(.2,.9,.2,1)}
  .sidebar.open{transform:translateX(0)}
  .hamburger{display:inline-flex}
}

/* Main content */
.main{padding-left:6px;padding-right:6px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(420px,1fr));gap:18px}
.card{background:var(--card-grad);border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.02);font-family:Roboto;font-size:14px}
canvas.graph{width:100%;height:300px;display:block;border-radius:8px;background:linear-gradient(180deg,#0d1117,#071018);box-shadow:inset 0 1px 0 rgba(255,255,255,0.01);touch-action:none; -webkit-user-select:none; -webkit-tap-highlight-color:transparent}
.controls-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:10px}
.switch{--w:44px;--h:24px;display:inline-flex;align-items:center;gap:8px}
.switch input{display:none}
.knob{width:var(--w);height:var(--h);border-radius:999px;padding:3px;background:var(--toggle-off);box-sizing:content-box;position:relative;transition:all .18s ease;display:inline-block}
.knob::after{content:"";position:absolute;width:18px;height:18px;border-radius:50%;left:3px;top:3px;background:#0f1216;transition:all .18s ease;box-shadow:0 2px 8px rgba(0,0,0,0.6)}
.switch input:checked + .knob{background:linear-gradient(90deg,var(--toggle-on),var(--accent-2))}
.switch input:checked + .knob::after{transform:translateX(20px);background:white}
.switch .txt{color:var(--muted);font-size:13px}
input[type="range"]{-webkit-appearance:none;appearance:none;height:8px;border-radius:999px;background:linear-gradient(90deg,#0b1116,#071018);outline:none;width:180px}
input[type="range"]::-webkit-slider-runnable-track{height:8px;border-radius:8px;background:linear-gradient(90deg,#1b2430,#0b1116)}
input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--accent);margin-top:-5px;box-shadow:0 4px 14px rgba(92,138,255,0.2)}
button.small{background:#0b1116;border:1px solid rgba(255,255,255,0.03);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer;font-family:Roboto}
.desc{color:var(--muted);font-size:13px;margin-top:8px}
.tval{width:56px;text-align:right;color:var(--muted)}

/* smooth animations for active state */
.sidebar-item, .knob, .settings-btn { will-change: transform, opacity; }

/* settings modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;z-index:300}
.modal{width:520px;background:linear-gradient(180deg,#0f1316,#0b0f12);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 20px 60px rgba(0,0,0,0.7);font-family:Roboto}
.modal h3{margin:0 0 10px 0;color:var(--accent-2);font-family:Poppins;font-weight:600}
.modal .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.modal label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
.modal input, .modal select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:#071018;color:var(--text)}
.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
@media (max-width:520px){.modal{width:92%}}
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="title">ITs-Ease — 2D playground</div>
  <div class="top-actions">
    <button id="hamburger" class="hamburger" aria-label="Open menu">☰</button>
    <button id="openSettings" class="settings-btn" aria-haspopup="dialog" aria-controls="modalBackdrop">Settings</button>
  </div>
</div>

<!-- Layout -->
<div class="container">
  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar" aria-label="Easing list">
    <div class="search">
      <input id="searchBox" placeholder="Filter easings..." />
    </div>
    <h4>Easing functions</h4>
    <ul class="sidebar-list" id="sidebarList" role="list"></ul>
    <div class="sidebar-indicator" aria-hidden="true"><div class="bar" id="sidebarBar"></div></div>
  </nav>

  <!-- Main -->
  <main class="main">
    <div id="cardsWrapper" class="grid"></div>
  </main>
</div>

<!-- Settings Modal -->
<div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <h3 id="settingsTitle">Graph settings</h3>
    <div class="grid">
      <div>
        <label for="s_showArrows">Show axis arrows</label>
        <select id="s_showArrows"><option value="true">Yes</option><option value="false">No</option></select>
      </div>
      <div>
        <label for="s_showGrid">Show grid</label>
        <select id="s_showGrid"><option value="true">Yes</option><option value="false">No</option></select>
      </div>
      <div>
        <label for="s_padLeft">Left padding (px)</label>
        <input id="s_padLeft" type="number" min="10" max="120" value="50"/>
      </div>
      <div>
        <label for="s_padBottom">Bottom padding (px)</label>
        <input id="s_padBottom" type="number" min="10" max="120" value="50"/>
      </div>
      <div>
        <label for="s_padRight">Right padding (px)</label>
        <input id="s_padRight" type="number" min="10" max="120" value="20"/>
      </div>
      <div>
        <label for="s_padTop">Top padding (px)</label>
        <input id="s_padTop" type="number" min="5" max="80" value="20"/>
      </div>
    </div>
    <div style="margin-top:12px">
      <label for="s_heightMul">Graph height multiplier</label>
      <input id="s_heightMul" type="range" min="0.2" max="1" step="0.05" value="0.85" />
    </div>

    <div class="actions" style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
      <button id="applySettings" class="small">Apply</button>
      <button id="closeSettings" class="small">Close</button>
    </div>
  </div>
</div>

<script>
/* -------------------------
   EASINGS & utilities
   ------------------------- */
const easingFunctions = {
  linear: t => t,
  easeInQuad: t => t*t,
  easeOutQuad: t => t*(2-t),
  easeInOutQuad: t => t<0.5 ? 2*t*t : -1+(4-2*t)*t,
  easeInCubic: t => t*t*t,
  easeOutCubic: t => (--t)*t*t+1,
  easeInOutCubic: t => t<0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2,
  easeInQuart: t => t*t*t*t,
  easeOutQuart: t => 1 - Math.pow(1-t,4),
  easeInOutQuart: t => t<0.5?8*Math.pow(t,4):1-8*Math.pow(1-t,4),
  easeInQuint: t => t*t*t*t*t,
  easeOutQuint: t => 1 - Math.pow(1-t,5),
  easeInOutQuint: t => t<0.5?16*Math.pow(t,5):1-16*Math.pow(1-t,5),
  easeInSine: t => 1 - Math.cos(t*Math.PI/2),
  easeOutSine: t => Math.sin(t*Math.PI/2),
  easeInOutSine: t => -(Math.cos(Math.PI*t)-1)/2,
  smoothStep: t => t*t*(3-2*t),
  smootherStep: t => t*t*t*(t*(6*t-15)+10)
};

let globalSettings = { padLeft:50, padBottom:50, padRight:20, padTop:20, heightMul:0.85, showArrows:true, showGrid:false };
function clamp01(v){ return v<=0?0: v>=1?1: v; }
function computeT(elapsedMs, durationSec, loop, mirror){
  const raw = elapsedMs / (durationSec*1000);
  if(!loop) return clamp01(raw);
  if(!mirror) return raw % 1;
  const cycle = raw % 2;
  return cycle <= 1 ? cycle : 2 - cycle;
}
function toTitleCase(str){ return str.replace(/\w\S*/g, txt => txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()); }
function toSentence(s){ const spaced = s.replace(/([A-Z])/g,' $1').trim(); return spaced.charAt(0).toUpperCase() + spaced.slice(1); }

/* Pointer drag helper (mouse & touch) */
function addPointerDrag(elem, handlers){
  let active = false;
  let preventScroll = ev => ev.preventDefault();

  function clientFromMouse(e){ return {x:e.clientX,y:e.clientY,e}; }
  function clientFromTouch(e){ const t = e.touches[0] || e.changedTouches[0]; return {x:t.clientX,y:t.clientY,e}; }

  elem.addEventListener('mousedown', e=>{
    const {x,y} = clientFromMouse(e);
    active = true;
    handlers.onDown && handlers.onDown(x,y,e);
    const move = me => { if(!active) return; const p = clientFromMouse(me); handlers.onMove && handlers.onMove(p.x,p.y,me); };
    const up = ue => { if(!active) return; active=false; handlers.onUp && handlers.onUp(ue); window.removeEventListener('mousemove',move); window.removeEventListener('mouseup',up); };
    window.addEventListener('mousemove',move);
    window.addEventListener('mouseup',up);
  });

  elem.addEventListener('touchstart', e=>{
    if(e.touches.length>1) return;
    const {x,y} = clientFromTouch(e);
    active=true;
    handlers.onDown && handlers.onDown(x,y,e);
    document.addEventListener('touchmove', preventScroll, {passive:false});
    const move = me => { if(!active) return; const p = clientFromTouch(me); handlers.onMove && handlers.onMove(p.x,p.y,me); };
    const up = ue => { if(!active) return; active=false; handlers.onUp && handlers.onUp(ue); window.removeEventListener('touchmove',move); window.removeEventListener('touchend',up); document.removeEventListener('touchmove',preventScroll); };
    window.addEventListener('touchmove',move,{passive:false});
    window.addEventListener('touchend',up);
  }, {passive:false});
}

/* ---------- Build UI: sidebar & cards ---------- */
const sidebarList = document.getElementById('sidebarList');
const cardsWrapper = document.getElementById('cardsWrapper');
const easingNames = Object.keys(easingFunctions);

// create sidebar items
easingNames.forEach(name=>{
  const li = document.createElement('li');
  li.className = 'sidebar-item';
  li.dataset.target = `card_${name}`;
  li.innerHTML = `<div class="name">${toTitleCase(name.replace(/([A-Z])/g,' $1').trim())}</div><div class="meta">${name}</div>`;
  sidebarList.appendChild(li);
});

// mobile hamburger
const hamburger = document.getElementById('hamburger');
const sidebar = document.getElementById('sidebar');
hamburger.addEventListener('click', ()=> sidebar.classList.toggle('open'));

// search filter
const searchBox = document.getElementById('searchBox');
searchBox.addEventListener('input', ()=> {
  const q = searchBox.value.toLowerCase();
  [...sidebarList.children].forEach(li=>{
    const nm = li.querySelector('.name').textContent.toLowerCase();
    li.style.display = nm.includes(q) ? '' : 'none';
  });
});

// create cards
easingNames.forEach(name=>{
  const card = document.createElement('section');
  card.id = `card_${name}`;
  card.className = 'card';
  card.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="display:flex;flex-direction:column">
        <strong style="font-size:15px;font-family:Poppins">${toTitleCase(name.replace(/([A-Z])/g,' $1').trim())}</strong>
        <span style="color:var(--muted);font-size:13px">${name}</span>
      </div>
      <div style="font-size:13px;color:var(--muted)">interactive demo</div>
    </div>

    <canvas class="graph" id="g_${name}" aria-label="${name} graph"></canvas>

    <div class="controls-row" style="margin-top:8px">
      <label class="switch"><input type="checkbox" id="enable_${name}" /><span class="knob"></span><span class="txt">Enable slider</span></label>
      <label class="switch"><input type="checkbox" id="loop_${name}" /><span class="knob"></span><span class="txt">Loop animation</span></label>
      <label class="switch"><input type="checkbox" id="mirror_${name}" /><span class="knob"></span><span class="txt">Mirror (ping-pong)</span></label>
    </div>

    <div class="controls-row" style="margin-top:10px;align-items:center">
      <div style="display:flex;align-items:center;gap:8px">
        <span class="label-muted">t</span>
        <input type="range" id="slider_${name}" min="0" max="1" step="0.01" value="0" />
        <div class="tval" id="tval_${name}">0.00</div>
      </div>

      <div style="display:flex;align-items:center;gap:8px;margin-left:auto">
        <div style="display:flex;flex-direction:column;align-items:flex-end">
          <span class="label-muted" style="font-size:13px">Duration (s)</span>
          <input type="range" id="dur_${name}" min="0.5" max="6" step="0.1" value="2" />
        </div>
        <button class="small" id="reset_${name}">Reset</button>
      </div>
    </div>

    <div class="desc">Example: ${toSentence(name)} — ${["Smooth UI transitions","Game character movement","Progress bar","Popup entrance","Carousel slide","Button hover","Camera movement","Loading spinner","Tooltip fade-in","Score counter"][Math.floor(Math.random()*10)]}</div>
  `;
  cardsWrapper.appendChild(card);
  
// canvas setup
  const canvas = card.querySelector('canvas');
  const ctx = canvas.getContext('2d');

  function resizeCanvas(){
    const cssW = canvas.clientWidth;
    const cssH = 300;
    canvas.width = Math.round(cssW * devicePixelRatio);
    canvas.height = Math.round(cssH * devicePixelRatio);
    canvas.style.height = cssH + 'px';
    ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  // controls
  const enableSlider = card.querySelector(`#enable_${name}`);
  const loopChk = card.querySelector(`#loop_${name}`);
  const mirrorChk = card.querySelector(`#mirror_${name}`);
  const slider = card.querySelector(`#slider_${name}`);
  const tval = card.querySelector(`#tval_${name}`);
  const dur = card.querySelector(`#dur_${name}`);
  const resetBtn = card.querySelector(`#reset_${name}`);

  let startTime = performance.now();
  resetBtn.addEventListener('click', ()=>{ startTime = performance.now(); slider.value = 0; tval.textContent = '0.00'; });

  const trail = []; const maxTrail = 36;
  function getPlotParams(){
    const w = canvas.clientWidth; const h = canvas.clientHeight;
    const padLeft = globalSettings.padLeft; const padBottom = globalSettings.padBottom;
    const padRight = globalSettings.padRight; const padTop = globalSettings.padTop;
    const plotW = w - padLeft - padRight; const plotH = (h - padTop - padBottom) * globalSettings.heightMul;
    return {w,h,padLeft,padBottom,padRight,padTop,plotW,plotH};
  }

  function drawAxes(padLeft,padBottom,padRight,padTop,showArrows,showGrid){
    const {w,h} = getPlotParams();
    if(showGrid){
      ctx.strokeStyle = 'rgba(130,140,150,0.04)'; ctx.lineWidth = 1;
      const stepX = 50; const stepY = 40;
      for(let x=padLeft; x<w-padRight; x+=stepX){ ctx.beginPath(); ctx.moveTo(x,padTop); ctx.lineTo(x,h-padBottom); ctx.stroke(); }
      for(let y=padTop; y<h-padBottom; y+=stepY){ ctx.beginPath(); ctx.moveTo(padLeft,y); ctx.lineTo(w-padRight,y); ctx.stroke(); }
    }
    ctx.strokeStyle = '#30363d'; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(padLeft, h - padBottom); ctx.lineTo(w - padRight, h - padBottom); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(padLeft, h - padBottom); ctx.lineTo(padLeft, padTop); ctx.stroke();
    if(showArrows){
      const arrowSize = 8; ctx.fillStyle='#30363d';
      ctx.beginPath(); ctx.moveTo(w - padRight - arrowSize, h - padBottom - 6); ctx.lineTo(w - padRight, h - padBottom); ctx.lineTo(w - padRight - arrowSize, h - padBottom + 6); ctx.fill();
      ctx.beginPath(); ctx.moveTo(padLeft -6, padTop + arrowSize); ctx.lineTo(padLeft, padTop); ctx.lineTo(padLeft +6, padTop + arrowSize); ctx.fill();
    }
  }

  function drawCurve(){
    const {w,h,padLeft,padBottom,padRight,padTop,plotW,plotH} = getPlotParams();
    ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);
    drawAxes(padLeft,padBottom,padRight,padTop, globalSettings.showArrows, globalSettings.showGrid);
    ctx.fillStyle = '#8b949e'; ctx.font = '12px Roboto';
    ctx.fillText('0', padLeft - 14, canvas.clientHeight - padBottom + 4);

    ctx.beginPath(); ctx.lineWidth = 2; ctx.strokeStyle = 'rgba(88,166,255,0.95)';
    const samples = 240;
    for(let i=0;i<=samples;i++){
      const tt = i/samples; const ex = easingFunctions[name](tt);
      const x = padLeft + tt * plotW; const y = (canvas.clientHeight - padBottom) - ex * plotH;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.stroke();

    ctx.fillStyle = '#ff7f50';
    const sx = padLeft, sy = canvas.clientHeight - padBottom;
    const ex = padLeft + plotW, ey = (canvas.clientHeight - padBottom) - easingFunctions * plotH;
    ctx.beginPath(); ctx.arc(sx, sy, 5, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(ex, ey, 5, 0, Math.PI*2); ctx.fill();
    return {sx,sy,ex,ey,plotW,plotH,padLeft,padBottom,padTop,w,h};
  }

  // dragging on canvas
  let prevEnable=null, isDragging=false;
  addPointerDrag(canvas, {
    onDown(x,y){
      const rect = canvas.getBoundingClientRect();
      const localX = x - rect.left; const localY = y - rect.top;
      const {padLeft,padBottom,plotW,plotH,w,h} = getPlotParams();
      if(localX < padLeft - 10 || localX > w - padRight + 10 || localY < 0 || localY > h + 10) return;
      isDragging = true; prevEnable = enableSlider.checked; enableSlider.checked = true;
      const t = clamp01((localX - padLeft) / plotW);
      slider.value = t.toFixed(2); tval.textContent = t.toFixed(2);
    },
    onMove(x,y){
      if(!isDragging) return;
      const rect = canvas.getBoundingClientRect();
      const localX = x - rect.left;
      const {padLeft,plotW} = getPlotParams();
      const t = clamp01((localX - padLeft) / plotW);
      slider.value = t.toFixed(2); tval.textContent = t.toFixed(2);
    },
    onUp(){
      if(!isDragging) return; isDragging=false;
      if(prevEnable !== null) enableSlider.checked = prevEnable; prevEnable = null;
    }
  });
  slider.addEventListener('input', ()=>{ tval.textContent = parseFloat(slider.value).toFixed(2); });

  // animation loop for this card
  function animate(now){
    const elapsed = now - startTime; const durationSec = parseFloat(dur.value);
    const loop = loopChk.checked; const mirror = mirrorChk.checked;
    let t = computeT(elapsed, durationSec, loop, mirror);
    if(enableSlider.checked){ t = parseFloat(slider.value); tval.textContent = t.toFixed(2); }
    else { slider.value = t.toFixed(2); tval.textContent = t.toFixed(2); }

    const frame = drawCurve();
    const ex = easingFunctions[name](t);
    const ballX = frame.padLeft + t * frame.plotW;
    const ballY = (frame.h - frame.padBottom) - ex * frame.plotH;

    trail.push({x:ballX,y:ballY}); if(trail.length>maxTrail) trail.shift();
    for(let i=0;i<trail.length;i++){ const p = trail[i]; const a = (i+1)/trail.length * 0.6; ctx.beginPath(); ctx.fillStyle = `rgba(127,90,240,${a})`; ctx.arc(p.x,p.y,6*(i+1)/trail.length,0,Math.PI*2); ctx.fill(); }
    ctx.beginPath(); ctx.fillStyle = '#ffffff'; ctx.arc(ballX,ballY,7,0,Math.PI*2); ctx.fill();
    ctx.fillStyle = '#8b949e'; ctx.font = '12px Roboto'; ctx.fillText(`t: ${t.toFixed(3)}`, frame.padLeft + 6, 20); ctx.fillText(`value: ${ex.toFixed(3)}`, frame.padLeft + 90,20);

    requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);
});

/* ---- Sidebar click -> scroll to card ---- */
const sidebarItems = [...document.querySelectorAll('.sidebar-item')];
sidebarItems.forEach(li=>{
  li.addEventListener('click', ()=>{
    if(window.innerWidth < 980) sidebar.classList.remove('open');
    const targetId = li.dataset.target;
    const el = document.getElementById(targetId);
    if(!el) return;
    // consider fixed header offset
    const headerOffset = 80;
    const rect = el.getBoundingClientRect();
    const offsetTop = window.scrollY + rect.top - headerOffset;
    window.scrollTo({ top: offsetTop, behavior: 'smooth' });
  });
});

/* ---- Active highlight using IntersectionObserver ---- */
const observerOptions = { root: null, rootMargin: '-30% 0px -30% 0px', threshold: 0.4 };
const observer = new IntersectionObserver((entries)=>{
  entries.forEach(entry=>{
    const id = entry.target.id; // card_name
    const li = sidebarList.querySelector(`[data-target="${id}"]`);
    if(entry.isIntersecting){
      sidebarList.querySelectorAll('.sidebar-item').forEach(i=> i.classList.remove('active'));
      if(li) li.classList.add('active');
      // animate indicator bar to the position of active item
      if(li){
        const bar = document.getElementById('sidebarBar');
        const listRect = sidebarList.getBoundingClientRect();
        const itemRect = li.getBoundingClientRect();
        const relY = itemRect.top - listRect.top;
        // compute percentage transform relative to sidebar indicator width
        const parentH = sidebarList.scrollHeight || sidebarList.clientHeight;
        const pct = (relY / Math.max(1, parentH)) * 100;
        // set transform translateX using percentage (visual effect)
        bar.style.transform = `translateX(${pct}%)`;
        // widen bar slightly for active
        bar.style.width = `calc(40px + ${Math.min(120, itemRect.width * 0.02)}px)`;
      }
    }
  });
}, observerOptions);

document.querySelectorAll('section.card').forEach(card => observer.observe(card));

/* ---- Settings modal logic (fixed) ---- */
const openSettings = document.getElementById('openSettings');
const modalBackdrop = document.getElementById('modalBackdrop');
const closeSettings = document.getElementById('closeSettings');
const applySettings = document.getElementById('applySettings');

openSettings.addEventListener('click', ()=>{ modalBackdrop.style.display='flex'; modalBackdrop.setAttribute('aria-hidden','false'); });
closeSettings.addEventListener('click', ()=>{ modalBackdrop.style.display='none'; modalBackdrop.setAttribute('aria-hidden','true'); });

document.getElementById('s_padLeft').value = globalSettings.padLeft;
document.getElementById('s_padBottom').value = globalSettings.padBottom;
document.getElementById('s_padRight').value = globalSettings.padRight;
document.getElementById('s_padTop').value = globalSettings.padTop;
document.getElementById('s_heightMul').value = globalSettings.heightMul;
document.getElementById('s_showArrows').value = globalSettings.showArrows? 'true':'false';
document.getElementById('s_showGrid').value = globalSettings.showGrid? 'true':'false';

applySettings.addEventListener('click', ()=>{
  globalSettings.padLeft = parseInt(document.getElementById('s_padLeft').value)||50;
  globalSettings.padBottom = parseInt(document.getElementById('s_padBottom').value)||50;
  globalSettings.padRight = parseInt(document.getElementById('s_padRight').value)||20;
  globalSettings.padTop = parseInt(document.getElementById('s_padTop').value)||20;
  globalSettings.heightMul = parseFloat(document.getElementById('s_heightMul').value)||0.85;
  globalSettings.showArrows = document.getElementById('s_showArrows').value === 'true';
  globalSettings.showGrid = document.getElementById('s_showGrid').value === 'true';
  modalBackdrop.style.display='none';
  modalBackdrop.setAttribute('aria-hidden','true');
});
modalBackdrop.addEventListener('click', (e)=>{ if(e.target===modalBackdrop){ modalBackdrop.style.display='none'; modalBackdrop.setAttribute('aria-hidden','true'); }});

</script>
</body>
</html>
